<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebChat Monitoring Dashboard</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ü–ï–†–ï–î —Å—Ç–∏–ª—è–º–∏ –∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ -->
<script src="cache-control.php?file=monitoring-config.js"></script>
<link rel="stylesheet" href="cache-control.php?file=monitoring.css">
</head>
<body>
    <div class="header">
    <div class="container">
        <div class="header-content">
            <h1>
                <span class="emoji-icon">üìä</span>
                <span data-translate="header.title">WebChat Monitoring Dashboard</span>
                <span class="live-indicator">
                    <span class="live-dot"></span>
                    <span data-translate="header.live">Live</span>
                </span>
            </h1>
            <div class="header-controls">
                <div class="theme-switcher">
                    <span>‚òÄÔ∏è</span>
                    <div class="theme-toggle" onclick="toggleTheme()">
                        <div class="theme-toggle-slider">
                            <span id="themeIcon">‚òÄÔ∏è</span>
                        </div>
                    </div>
                    <span>üåô</span>
                </div>
                <button class="settings-btn" onclick="openSettingsModal()">
                    <span style="font-size: 20px;">‚öôÔ∏è</span>
                    <span class="settings-text" data-translate="header.settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
            </div>
        </div>
    </div>
</div>
    
    <div class="container">
        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
            <!-- –§–∏–ª—å—Ç—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
            <div class="filter-group" data-filter="period" style="display: none;">
                <label data-translate="filters.period.label">–ü–µ—Ä–∏–æ–¥</label>
                <select id="periodFilter">
                    <option value="1h" data-translate="filters.period.options.1h">–ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å</option>
                    <option value="24h" selected data-translate="filters.period.options.24h">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</option>
                    <option value="7d" data-translate="filters.period.options.7d">–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–¥–µ–ª—è</option>
                    <option value="30d" data-translate="filters.period.options.30d">–ü–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</option>
                    <option value="custom" data-translate="filters.period.options.custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                </select>
            </div>
            
            <div class="filter-group" id="customDateRange" style="display: none;">
                <label data-translate="filters.period.customStart">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                <input type="datetime-local" id="startDate">
            </div>
            
            <div class="filter-group" id="customDateRangeEnd" style="display: none;">
                <label data-translate="filters.period.customEnd">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                <input type="datetime-local" id="endDate">
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -->
            <div class="filter-group" data-filter="configuration" style="display: none;">
                <label data-translate="filters.configuration.label">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</label>
                <select id="configFilter">
                    <option value="all" data-translate="filters.configuration.all">–í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</option>
                    <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </select>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã -->
            <div class="filter-group" data-filter="platform" style="display: none;">
                <label data-translate="filters.platform.label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                <select id="platformFilter">
                    <option value="all" data-translate="filters.platform.all">–í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</option>
                    <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </select>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –∏ –ø–æ–∏—Å–∫ -->
            <div class="filter-group buttons-group" data-filter="refreshButton" style="display: none;">
                <label style="visibility: hidden;">_</label>
                <button class="refresh-btn" onclick="refreshData()">
                    <span class="refresh-icon">üîÑ</span>
                    <span data-translate="filters.buttons.refresh">–û–±–Ω–æ–≤–∏—Ç—å</span>
                </button>
            </div>
            
           <!-- –ö–Ω–æ–ø–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ -->
<div class="filter-group" data-filter="analysisButtons" style="display: none;">
    <label data-translate="analysisResultLanguage.label">–Ø–∑—ã–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞</label>
    <div style="display: flex; gap: 10px;">
        <button class="analysis-btn" id="resultLanguageBtn" onclick="openResultLanguageModal()">
            <span id="resultLanguageFlag">üåê</span> <span id="resultLanguageText">...</span>
        </button>
        <button class="analysis-btn" onclick="analyzeByLanguage()">
            üåê <span data-translate="filters.buttons.analyzeByLanguage">–ê–Ω–∞–ª–∏–∑ –ø–æ —è–∑—ã–∫—É</span>
        </button>
    </div>
</div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="stat-card" data-stat="totalUsers" style="display: none;">
                <div class="sparkles">
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                </div>
                <div class="stat-card-header">
                    <div>
                        <h3 data-translate="stats.totalUsers.title">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <div class="stat-value" id="totalUsers">-</div>
                        <div class="stat-change positive" id="usersChange">
                            <span class="trend-icon">üìà</span>
                            <span>+12% <span data-translate="stats.totalUsers.trend">–∑–∞ –ø–µ—Ä–∏–æ–¥</span></span>
                        </div>
                    </div>
                    <div class="stat-icon">üë•</div>
                </div>
            </div>
            
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ -->
            <div class="stat-card" data-stat="activeSessions" style="display: none;">
                <div class="sparkles">
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                </div>
                <div class="stat-card-header">
                    <div>
                        <h3 data-translate="stats.activeSessions.title">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏</h3>
                        <div class="stat-value" id="activeSessions">-</div>
                        <div class="stat-change" id="sessionsChange">
                            <span class="trend-icon">üìä</span>
                            <span data-translate="stats.activeSessions.trend">–°—Ç–∞–±–∏–ª—å–Ω–æ</span>
                        </div>
                    </div>
                    <div class="stat-icon">üü¢</div>
                </div>
            </div>
            
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ -->
            <div class="stat-card" data-stat="avgSessionTime" style="display: none;">
                <div class="sparkles">
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                </div>
                <div class="stat-card-header">
                    <div>
                        <h3 data-translate="stats.avgSessionTime.title">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏</h3>
                        <div class="stat-value" id="avgSessionTime">-</div>
                        <div class="stat-change positive" id="sessionTimeChange">
                            <span class="trend-icon">‚è±Ô∏è</span>
                            <span>+5% <span data-translate="stats.avgSessionTime.trend">–∑–∞ –ø–µ—Ä–∏–æ–¥</span></span>
                        </div>
                    </div>
                    <div class="stat-icon">‚è∞</div>
                </div>
            </div>
            
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π -->
            <div class="stat-card" data-stat="totalMessages" style="display: none;">
                <div class="sparkles">
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                    <span class="sparkle"></span>
                </div>
                <div class="stat-card-header">
                    <div>
                        <h3 data-translate="stats.totalMessages.title">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        <div class="stat-value" id="totalMessages">-</div>
                        <div class="stat-change positive" id="messagesChange">
                            <span class="trend-icon">üí¨</span>
                            <span>+18% <span data-translate="stats.totalMessages.trend">–∑–∞ –ø–µ—Ä–∏–æ–¥</span></span>
                        </div>
                    </div>
                    <div class="stat-icon">üì©</div>
                </div>
            </div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
        <div class="charts-grid">
            <!-- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
            <div class="chart-card" data-chart="activity" style="display: none;">
                <h3>
                    üìà <span data-translate="charts.activity.title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏</span>
                    <span class="chart-refresh tooltip" data-tooltip-translate="charts.activity.refresh" data-tooltip="–û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫" onclick="updateCharts()">üîÑ</span>
                </h3>
                <div class="chart-placeholder" id="activityChart">
                    <canvas id="activityCanvas" width="400" height="300"></canvas>
                </div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ -->
            <div class="chart-card" data-chart="geography" style="display: none;">
                <h3>
                    üåç <span data-translate="charts.geography.title">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                    <span class="chart-refresh tooltip" data-tooltip-translate="charts.geography.refresh" data-tooltip="–û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫" onclick="updateCharts()">üîÑ</span>
                </h3>
                <div class="chart-placeholder" id="geoChart">
                    <canvas id="geoCanvas" width="400" height="300"></canvas>
                </div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º -->
            <div class="chart-card" data-chart="platforms" style="display: none;">
                <h3>
                    üì± <span data-translate="charts.platforms.title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º</span>
                    <span class="chart-refresh tooltip" data-tooltip-translate="charts.platforms.refresh" data-tooltip="–û–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫" onclick="updateCharts()">üîÑ</span>
                </h3>
                <div class="chart-placeholder" id="platformChart">
                    <canvas id="platformCanvas" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
        
       <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div class="users-table">
    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ email –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–∫–ª—é—á–µ–Ω) -->
    <div class="table-tabs" id="tableTabs" style="display: none;">
        <button class="tab-btn active" onclick="switchTableTab('messengers')" data-tab="messengers">
            üí¨ <span data-translate="emailMonitoring.tabs.messengers">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤</span>
        </button>
        <button class="tab-btn" onclick="switchTableTab('email')" data-tab="email">
            üìß <span data-translate="emailMonitoring.tabs.email">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Email</span>
        </button>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ -->
    <div id="messengersTableContainer" class="table-container active">
        <div class="table-header">
            <h3>üë• <span data-translate="table.title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></h3>
            <div class="table-controls">
                <input type="text" class="search-box" data-filter="search" style="display: none;" 
                       placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ IP, —Å—Ç—Ä–∞–Ω–µ, –≥–æ—Ä–æ–¥—É..." 
                       data-translate-placeholder="filters.search.placeholder" id="searchBox">
                <button class="export-btn" onclick="exportData()">
                    üì§ <span data-translate="table.export">–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
            </div>
        </div>
        
        <!-- –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
<div class="table-wrapper" id="tableContainer">
    <table>
        <thead>
            <tr id="tableHeaderRow">
                <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </tr>
        </thead>
        <tbody id="usersTableBody">
            <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JavaScript -->
        </tbody>
    </table>
</div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="mobile-cards" id="mobileCards"></div>
        
        <div class="pagination">
            <button id="prevPage" onclick="changePage(-1)">
                ‚Üê <span data-translate="pagination.previous">–ù–∞–∑–∞–¥</span>
            </button>
            <div class="page-numbers" id="pageNumbers"></div>
            <button id="nextPage" onclick="changePage(1)">
                <span data-translate="pagination.next">–í–ø–µ—Ä–µ–¥</span> ‚Üí
            </button>
        </div>
    </div>
    <!-- –ö–æ–Ω–µ—Ü –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ -->
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã email -->
    <div id="emailTableContainer" class="table-container" style="display: none;">
        <div class="table-header">
            <h3>üìß <span data-translate="emailMonitoring.tabs.email">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Email</span></h3>
            <div class="table-controls">
                <input type="text" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ email, –∏–º–µ–Ω–∏, —Ç–µ–º–µ..." 
                       id="emailSearchBox">
                <button class="export-btn" onclick="exportEmailData()">
                    üì§ <span data-translate="table.export">–≠–∫—Å–ø–æ—Ä—Ç</span>
                </button>
            </div>
        </div>
        
        <!-- –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ email -->
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr id="emailTableHeaderRow">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </tr>
                </thead>
                <tbody id="emailTableBody">
                    <tr>
                        <td colspan="9" class="loading">
                            <div class="spinner"></div>
                            <span data-translate="emailMonitoring.table.loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö email...</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ email -->
        <div class="mobile-cards" id="emailMobileCards"></div>
        
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è email -->
        <div class="pagination">
            <button id="emailPrevPage" onclick="changeEmailPage(-1)">
                ‚Üê <span data-translate="pagination.previous">–ù–∞–∑–∞–¥</span>
            </button>
            <div class="page-numbers" id="emailPageNumbers"></div>
            <button id="emailNextPage" onclick="changeEmailPage(1)">
                <span data-translate="pagination.next">–í–ø–µ—Ä–µ–¥</span> ‚Üí
            </button>
        </div>
    </div>
    <!-- –ö–æ–Ω–µ—Ü –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ email -->
</div>
</div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="dialogModal" class="dialog-modal" onclick="closeDialog(event)">
        <div class="dialog-content" onclick="event.stopPropagation()">
            <div class="dialog-header">
                <h3 id="dialogTitle" data-translate="dialogs.dialog.title">–î–∏–∞–ª–æ–≥</h3>
                <button class="dialog-close" onclick="closeDialog()">√ó</button>
            </div>
            <div class="dialog-body" id="dialogBody">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p data-translate="dialogs.dialog.loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–∞...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="analysisModal" class="dialog-modal" onclick="closeAnalysis(event)">
        <div class="dialog-content" onclick="event.stopPropagation()">
            <div class="dialog-header">
                <h3 id="analysisTitle" data-translate="dialogs.analysis.title">–ê–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–∞</h3>
                <button class="dialog-close" onclick="closeAnalysis()">√ó</button>
            </div>
            <div class="dialog-body" id="analysisBody">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p data-translate="dialogs.analysis.loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∏–∞–ª–æ–≥...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="languageModal" class="dialog-modal" onclick="closeLanguageModal(event)">
    <div class="dialog-content" style="width: 400px;" onclick="event.stopPropagation()">
        <div class="dialog-header">
            <h3 data-translate="dialogs.language.title">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h3>
            <button class="dialog-close" onclick="closeLanguageModal()">√ó</button>
        </div>
        <div class="dialog-body" style="padding: 20px;">
            <div class="language-options" id="languageOptionsContainer">
                <!-- –ö–Ω–æ–ø–∫–∏ —è–∑—ã–∫–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
<div id="resultLanguageModal" class="dialog-modal" onclick="closeResultLanguageModal(event)">
    <div class="dialog-content" style="width: 400px;" onclick="event.stopPropagation()">
        <div class="dialog-header">
            <h3 data-translate="analysisResultLanguage.modalTitle">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞</h3>
            <button class="dialog-close" onclick="closeResultLanguageModal()">√ó</button>
        </div>
        <div class="dialog-body" style="padding: 20px;">
            <div class="language-options" id="resultLanguageOptionsContainer">
                <!-- –ö–Ω–æ–ø–∫–∏ —è–∑—ã–∫–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
</div>
    
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ -->
<div id="clientCardModal" class="dialog-modal" onclick="closeClientCard(event)">
    <div class="dialog-content" style="max-width: 900px;">
        <div class="dialog-header">
            <h3 id="clientCardTitle">–ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞</h3>
            <button class="dialog-close" onclick="closeClientCard()">&times;</button>
        </div>
        <div class="dialog-body" id="clientCardBody" style="padding: 0;">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>
</div>  
    
   <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div id="deleteConfirmModal" class="dialog-modal" onclick="closeDeleteConfirm(event)">
    <div class="modal-content delete-confirm-modal">
        <div class="delete-modal-icon">
            ‚ö†Ô∏è
        </div>
        <h2 id="deleteModalTitle"></h2>
        <p id="deleteModalMessage"></p>
        <p id="deleteModalId" class="delete-id-text"></p>
        <div class="delete-modal-buttons">
            <button class="btn-cancel" onclick="closeDeleteConfirm(true)">
                <span id="deleteCancelBtn"></span>
            </button>
            <button class="btn-delete" onclick="confirmDelete()">
                <span id="deleteConfirmBtn"></span>
            </button>
        </div>
    </div>
</div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ CRM -->
<div id="crmConfirmModal" class="dialog-modal" onclick="closeCRMConfirm(event)">
    <div class="modal-content delete-confirm-modal">
        <div class="delete-modal-icon">üîó</div>
        <h2 class="delete-modal-title" id="crmConfirmTitle"></h2>
        <p id="crmConfirmInfo" class="delete-id-text"></p>
        <div class="delete-modal-buttons">
            <button class="btn-cancel" onclick="closeCRMConfirm(false)">
                <span id="crmCancelBtn"></span>
            </button>
            <button class="btn-delete crm-send-btn" onclick="confirmCRMSend()">
                <span id="crmSendBtn"></span>
            </button>
        </div>
    </div>
</div>
    
   <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="dialog-modal" onclick="closeSettingsModal(event)">
        <div class="dialog-content" style="width: 600px;" onclick="event.stopPropagation()">
            <div class="dialog-header">
                <h3>‚öôÔ∏è <span data-translate="dialogs.settings.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</span></h3>
                <button class="dialog-close" onclick="closeSettingsModal()">√ó</button>
            </div>
            <div class="dialog-body" style="padding: 30px;">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–∞–Ω–∞–ª–∏–∑–∞ -->
                <div class="settings-section">
                    <h4 style="color: var(--accent-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        ü§ñ <span data-translate="dialogs.settings.autoAnalysis.title">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤</span>
                    </h4>
                    <div class="settings-row">
                        <label data-translate="dialogs.settings.autoAnalysis.enable">–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∞–Ω–∞–ª–∏–∑:</label>
                        <div class="toggle-switch" id="autoAnalysisToggleModal" onclick="toggleAutoAnalysis()" style="position: relative; width: 50px; height: 24px; background: var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.3s ease;">
                            <div class="toggle-slider" style="position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: all 0.3s ease;"></div>
                        </div>
                        <span id="serverStatusModal" style="font-size: 12px; color: var(--text-secondary);">üåê <span data-translate="dialogs.settings.autoAnalysis.serverMode">–°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º</span></span>
                    </div>
                    <div class="settings-row">
                        <label data-translate="dialogs.settings.autoAnalysis.delay">–ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="analysisDelayModal" value="30" min="5" max="120" class="settings-input">
                            <span style="color: var(--text-secondary);" data-translate="dialogs.settings.autoAnalysis.minutes">–º–∏–Ω—É—Ç</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-divider"></div>
                
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –ë–î -->
                <div class="settings-section">
                    <h4 style="color: var(--accent-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        üóëÔ∏è <span data-translate="dialogs.settings.dbCleanup.title">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</span>
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <span style="font-size: 14px; color: var(--success);">
                            ‚úÖ <span data-translate="dialogs.settings.dbCleanup.active">–ê–∫—Ç–∏–≤–Ω–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00)</span>
                        </span>
                    </div>
                    <div class="settings-row">
                        <label data-translate="dialogs.settings.dbCleanup.monitoringData">–•—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="monitoringRetentionModal" value="30" min="7" max="365" class="settings-input">
                            <span style="color: var(--text-secondary);" data-translate="dialogs.settings.dbCleanup.days">–¥–Ω–µ–π</span>
                        </div>
                    </div>
                    <div class="settings-row">
                        <label data-translate="dialogs.settings.dbCleanup.analysisResults">–•—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–æ–≤:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="analysisRetentionModal" value="90" min="30" max="365" class="settings-input">
                            <span style="color: var(--text-secondary);" data-translate="dialogs.settings.dbCleanup.days">–¥–Ω–µ–π</span>
                        </div>
                    </div>
                    <div class="settings-row">
                        <label data-translate="dialogs.settings.dbCleanup.dialogsData">–•—Ä–∞–Ω–∏—Ç—å –¥–∏–∞–ª–æ–≥–∏:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="dialogsRetentionModal" value="60" min="7" max="365" class="settings-input">
                            <span style="color: var(--text-secondary);" data-translate="dialogs.settings.dbCleanup.days">–¥–Ω–µ–π</span>
                        </div>
                    </div>
                    <div class="settings-row">
                        <label data-translate="dialogs.settings.dbCleanup.contactsData">–•—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" id="contactsRetentionModal" value="180" min="30" max="365" class="settings-input">
                            <span style="color: var(--text-secondary);" data-translate="dialogs.settings.dbCleanup.days">–¥–Ω–µ–π</span>
                        </div>
                    </div>
                </div>
                
                <div class="settings-divider"></div>
                
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CRM -->
<div class="settings-section" id="crmSettingsSection">
    <h4 style="color: var(--accent-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
        üîó <span data-translate="crm.title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CRM</span>
    </h4>
    
    <div class="settings-row">
        <label data-translate="crm.webhookUrl">Webhook URL –¥–ª—è CRM:</label>
        <input type="text" id="crmWebhookUrl" placeholder="https://your-crm.com/webhook/endpoint" class="settings-input" style="width: 100%; margin-top: 8px;">
        <small style="color: var(--text-secondary); display: block; margin-top: 8px; font-size: 12px;">
            <span data-translate="crm.webhookHint">–ü–æ–ª—É—á–∏—Ç–µ webhook URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–π CRM —Å–∏—Å—Ç–µ–º—ã</span>
        </small>
    </div>
    
    <div class="settings-row">
        <label data-translate="crm.autoSend" style="flex: 1;">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ—Ä—è—á–∏—Ö –ª–∏–¥–æ–≤:</label>
        <div class="toggle-switch" id="crmAutoSendToggle" onclick="toggleCRMAutoSend()" style="position: relative; width: 50px; height: 24px; background: var(--border-color); border-radius: 12px; cursor: pointer; transition: all 0.3s ease; flex-shrink: 0;">
            <div class="toggle-slider" style="position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: all 0.3s ease;"></div>
        </div>
    </div>
    
    <div class="settings-row">
        <label data-translate="crm.minScore">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Lead Score –¥–ª—è –∞–≤—Ç–æ–æ—Ç–ø—Ä–∞–≤–∫–∏:</label>
        <div style="display: flex; align-items: center; gap: 10px;">
            <input type="number" id="crmMinLeadScore" min="50" max="100" value="80" class="settings-input">
            <span style="color: var(--text-secondary);" data-translate="crm.scoreRange">(50-100)</span>
        </div>
    </div>
    
    <div class="settings-row" style="margin-top: 20px;">
        <button onclick="testCRMConnection()" class="settings-save-btn" style="margin-right: 10px;">
            üîß <span data-translate="crm.testConnection">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</span>
        </button>
        <span id="crmTestResult" style="font-size: 14px;"></span>
    </div>
</div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
                <div class="settings-actions">
                    <button class="settings-save-btn" onclick="saveAllSettings()">
                        üíæ <span data-translate="dialogs.settings.buttons.save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                    </button>
                    <button class="settings-cancel-btn" onclick="closeSettingsModal()">
                        <span data-translate="dialogs.settings.buttons.cancel">–û—Ç–º–µ–Ω–∞</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

<!-- ========================================= -->
<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –õ–û–ì–ò–ù–ê (–ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø) -->
<!-- ========================================= -->
<div id="authModal" class="auth-modal hidden">
    <div class="auth-backdrop"></div>
    <div class="auth-container">
        <div class="auth-card">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="auth-header">
                <div class="auth-logo">
                    <span class="auth-logo-icon">üîê</span>
                    <h1 class="auth-logo-text" data-translate="auth.modalTitle">Monitoring Dashboard</h1>
                </div>
                <p class="auth-subtitle" data-translate="auth.modalSubtitle">–í–≤–µ–¥–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</p>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
            <div id="authErrorMessage" class="auth-error-message" style="display: none;">
                <span class="auth-error-icon">‚ö†Ô∏è</span>
                <span id="authErrorText"></span>
            </div>

            <!-- –§–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ -->
            <form id="authLoginForm" class="auth-form">
                <div class="auth-form-group">
                    <label for="authUsername" class="auth-label">
                        <span class="auth-label-icon">üë§</span>
                        <span data-translate="auth.usernameLabel">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
                    </label>
                    <input
                        type="text"
                        id="authUsername"
                        name="username"
                        class="auth-input"
                        required
                        autocomplete="username"
                        data-translate-placeholder="auth.usernamePlaceholder"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω"
                        autofocus
                    >
                </div>

                <div class="auth-form-group">
                    <label for="authPassword" class="auth-label">
                        <span class="auth-label-icon">üîë</span>
                        <span data-translate="auth.passwordLabel">–ü–∞—Ä–æ–ª—å</span>
                    </label>
                    <div class="auth-password-wrapper">
                        <input
                            type="password"
                            id="authPassword"
                            name="password"
                            class="auth-input"
                            required
                            autocomplete="current-password"
                            data-translate-placeholder="auth.passwordPlaceholder"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                        >
                        <button type="button" class="auth-password-toggle" onclick="togglePasswordVisibility()">
                            <span id="authPasswordToggleIcon">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>

                <div class="auth-form-group auth-remember">
                    <label class="auth-checkbox-label">
                        <input type="checkbox" id="authRememberMe" name="rememberMe" class="auth-checkbox">
                        <span class="auth-checkbox-text" data-translate="auth.rememberMe">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è –Ω–∞ 7 –¥–Ω–µ–π</span>
                    </label>
                </div>

                <button type="submit" class="auth-submit-btn" id="authSubmitBtn">
                    <span id="authSubmitText" data-translate="auth.loginButton">–í–æ–π—Ç–∏</span>
                    <span id="authSubmitSpinner" class="auth-spinner" style="display: none;"></span>
                </button>
            </form>

            <!-- –§—É—Ç–µ—Ä -->
            <div class="auth-footer">
                <p class="auth-footer-text">
                    <span class="auth-footer-icon">üîí</span>
                    <span data-translate="auth.secureConnection">–ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</span>
                </p>
            </div>
        </div>
    </div>
</div>

<script src="cache-control.php?file=monitoring.js"></script>
</body>
</html>